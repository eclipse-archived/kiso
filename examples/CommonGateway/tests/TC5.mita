/**
 * Welcome to Eclipse Mita.
 *
 * Not sure what to do now?
 * Check out the "Getting started" guide on https://mita.io.
 */

package main;
import platforms.cgw;

/** Struct and variables definitions **/
struct v3d {
	var x: int16;
	var y: int16;
	var z: int16;
	var mag: uint32;
}

/* Declare variables for the BMA280 */
var mean_acc = v3d(0,0,0,0);

/** Setup **/
/* Setup logging */
setup CGW {
       consoleInterface = .UART();
}

/* Setup the accelerometer sensor BMA280 */
setup accelerometer {
}

every 100 milliseconds {
	/* Read sensor values */
	mean_acc.x = accelerometer.x_axis.read();
	mean_acc.y = accelerometer.y_axis.read();
	mean_acc.z = accelerometer.z_axis.read();
	mean_acc.mag = accelerometer.magnitude.read();
	
	/* Serialize message to send out */
	let msg = `{
		"x": ${mean_acc.x},
		"y": ${mean_acc.y},
		"z": ${mean_acc.z},
		"mag": ${mean_acc.mag}
		}\n`;
	/* Send message out */
	print(msg);
}
